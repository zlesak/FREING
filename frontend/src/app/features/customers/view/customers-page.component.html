<section class="page-table-cards">
  <div class="toolbar">
    <h2 style="margin: 10px;">Zákazníci</h2>
    <button mat-button class="add-button" (click)="router.navigate(['/customers/new'])">
      <mat-icon color="white" aria-label="add">add</mat-icon>
      Nový zákazník
    </button>
  </div>

  @if (loading()) {
    <mat-progress-bar style="width: 80%; margin: auto" mode="indeterminate"></mat-progress-bar>
  }

  @if (error) {
    <div class="error">{{ error }}</div>
  }

  @if (!loading() && !error && dataSource.data.length) {
    <div class="desktop-table">
      <table mat-table [dataSource]="dataSource" matSort class="table-cards-table">
        <ng-container matColumnDef="index">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let c; let i = index">{{ i + 1 }}</td>
        </ng-container>
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Jméno / Obchodní název</th>
          <td mat-cell *matCellDef="let c">
            @if (c.tradeName) {
              <strong>{{ c.tradeName }}</strong>
            } @else {
              {{ c.name }} {{ c.surname }}
            }
          </td>
        </ng-container>
        <ng-container matColumnDef="surname">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Příjmení</th>
          <td mat-cell *matCellDef="let c">{{ c.surname }}</td>
        </ng-container>
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let c">{{ c.email }}</td>
        </ng-container>
        <ng-container matColumnDef="phoneNumber">
          <th mat-header-cell *matHeaderCellDef>Telefon</th>
          <td mat-cell *matCellDef="let c">{{ c.phoneNumber }}</td>
        </ng-container>
        <ng-container matColumnDef="city">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Město</th>
          <td mat-cell *matCellDef="let c">{{ c.city }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns;"
          class="clickable-row"
          (click)="router.navigate(['/customers/edit', row.id])"
        ></tr>
      </table>
      <mat-paginator class="paginator"
             [length]="totalElements"
             [pageSize]="currentSize"
             [pageIndex]="currentPage"
             [pageSizeOptions]="[5, 10, 25, 50]"
             [showFirstLastButtons]="true"
             [disabled]="loading()"
             (page)="pageUpdate($event)">
      </mat-paginator>
    </div>
    <div class="mobile-cards">
      <ng-container *ngFor="let c of dataSource.data">
        <div class="table-card" (click)="router.navigate(['/customers/edit', c.id])">
          <div class="card-row"><strong>Jméno:</strong> {{ c.tradeName ? c.tradeName : (c.name + ' ' + c.surname) }}</div>
          <div class="card-row"><strong>Email:</strong> {{ c.email }}</div>
          <div class="card-row"><strong>Telefon:</strong> {{ c.phoneNumber }}</div>
          <div class="card-row"><strong>Město:</strong> {{ c.city }}</div>
        </div>
      </ng-container>
      <mat-paginator class="paginator"
             [length]="totalElements"
             [pageSize]="currentSize"
             [pageIndex]="currentPage"
             [pageSizeOptions]="[5, 10, 25, 50]"
             [showFirstLastButtons]="true"
             [disabled]="loading()"
             (page)="pageUpdate($event)">
      </mat-paginator>
    </div>
  }



  @if (!loading() && !error && !dataSource.data.length) {
    <p>Žádní zákazníci k zobrazení.</p>
  }
</section>
