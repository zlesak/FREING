<section class="page-table-cards">
  <div class="toolbar">
    <h2 style="margin: 10px;">Vygenerované PDF reporty</h2>
  </div>

  <app-invoice-report-filter
    (generate)="onGenerateReport($event)"
    [responsiveService]="responsiveService"
    [users]="customerList">
  </app-invoice-report-filter>

  @if (loading() || generating()) {
    <mat-progress-bar style="width: 80%; margin: auto" mode="indeterminate"></mat-progress-bar>
  }

  @if (error) {
    <div class="error">{{ error }}</div>
  }

  @if (!loading() && !error && dataSource.data.length) {
    <div class="table-scroll-area">
      <div class="desktop-table">
        <table mat-table [dataSource]="dataSource" matSort class="table-cards-table">
          <ng-container matColumnDef="filename">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Název souboru</th>
            <td mat-cell *matCellDef="let pdf">{{ pdf.filename }}</td>
          </ng-container>
          <ng-container matColumnDef="generatedAt">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Vytvořeno</th>
            <td mat-cell *matCellDef="let pdf">{{ pdf.generatedAt | date:'short' }}</td>
          </ng-container>
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Akce</th>
            <td mat-cell *matCellDef="let pdf">
              <button mat-icon-button (click)="openPdf(pdf.id)" title="Zobrazit PDF">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deletePdf(pdf.id)" title="Smazat PDF">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="clickable-row"
            (click)="openPdf(row.id)"></tr>
        </table>
        <mat-paginator class="paginator" [length]="totalElements" [pageSize]="currentSize"
          [pageSizeOptions]="[5, 10, 25, 50]" [showFirstLastButtons]="true" [disabled]="loading()"
          (page)="pageUpdate($event)">
        </mat-paginator>
      </div>
    </div>
    <div class="mobile-cards">
      <ng-container *ngFor="let pdf of dataSource.data">
        <div class="table-card" (click)="openPdf(pdf.id)">
          <div class="card-row"><strong>Název souboru:</strong> {{ pdf.filename }}</div>
          <div class="card-row"><strong>Vytvořeno:</strong> {{ pdf.generatedAt | date:'short' }}</div>
          <button mat-icon-button color="warn" (click)="deletePdf(pdf.id); $event.stopPropagation()" title="Smazat PDF">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </ng-container>
      <mat-paginator class="paginator" [length]="totalElements" [pageSize]="currentSize"
        [pageSizeOptions]="[5, 10, 25, 50]" [showFirstLastButtons]="true" [disabled]="loading()"
        (page)="pageUpdate($event)">
      </mat-paginator>
    </div>
  }

  @if (!loading() && !error && !dataSource.data.length) {
    <p>Žádné PDF dokumenty k zobrazení.</p>
  }
</section>
