<section class="page home">
  <form [formGroup]="filterForm">
    <div class="filter" [ngClass]="responsiveService.isMobile ? 'mobile' : ''">
    <mat-form-field
    subscriptSizing="dynamic"
    [hideRequiredMarker]="true"
    >
      <mat-label>Datum od</mat-label>
      <input matInput [matDatepicker]="IssueDatePicker"
             formControlName="from" />
      <mat-datepicker-toggle matIconSuffix [for]="IssueDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #IssueDatePicker></mat-datepicker>
    </mat-form-field>

      <mat-form-field
        subscriptSizing="dynamic"
        [hideRequiredMarker]="true"
      >
      <mat-label>Datum do</mat-label>
      <input matInput [matDatepicker]="dueDatePicker"
             formControlName="to" />
      <mat-datepicker-toggle matIconSuffix [for]="dueDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #dueDatePicker></mat-datepicker>
    </mat-form-field>

    @if(keycloakService.hasAdminAccess){
      <mat-form-field
        subscriptSizing="dynamic"
        [hideRequiredMarker]="true"
      >
        <mat-label>ZÃ¡kaznÃ­k</mat-label>
        <mat-select formControlName="customerId">
          <mat-option [value]="null"> zruÅ¡it vÃ½bÄ›r</mat-option>
          @for(user of users; track $index){
            <mat-option [value]="user.id">{{user.email}}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    }

      <mat-form-field
        subscriptSizing="dynamic"
        [hideRequiredMarker]="true"
      >
      <mat-label>Stav</mat-label>
      <mat-select formControlName="status">
        <mat-option [value]="null"> zruÅ¡it vÃ½bÄ›r</mat-option>
        @for (s of statusOptions; track s) {
          <mat-option [value]="s">{{ statusTranslation.getStatusLabel(s) }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

      <mat-form-field
        subscriptSizing="dynamic"
        [hideRequiredMarker]="true"
      >
      <mat-label>ÄŒÃ¡stka od</mat-label>
      <input matInput type="number" formControlName="amountFrom"/>
    </mat-form-field>

      <mat-form-field
        subscriptSizing="dynamic"
        [hideRequiredMarker]="true"
      >
      <mat-label>ÄŒÃ¡stka do</mat-label>
      <input matInput type="number" formControlName="amountTo"/>
    </mat-form-field>

      <mat-form-field
        subscriptSizing="dynamic"
        [hideRequiredMarker]="true"
      >
      <mat-label>MÄ›na</mat-label>
      <mat-select formControlName="currency">
        <mat-option [value]="null"> zruÅ¡it vÃ½bÄ›r</mat-option>
        @for (c of currencyOptions; track c) {
          <mat-option [value]="c">{{ c }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <button mat-raised-button color="primary" (click)="applyFilter()">
      Filtrovat
    </button>
    </div>
  </form>

  <div class="quick-stats" [ngClass]="responsiveService.isMobile ? 'mobile' : ''">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <div class="stat-label">Celkem Faktur</div>
        <div class="stat-value">{{ quickStats().totalCount }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ’°</div>
      <div class="stat-content">
        <div class="stat-label">CelkovÃ¡ ÄŒÃ¡stka</div>
        <div class="stat-value">{{ quickStats().totalAmount | number:'1.0-2' }} KÄ</div>
      </div>
    </div>
    <div class="stat-card success">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <div class="stat-label">Zaplaceno</div>
        <div class="stat-value">{{ quickStats().paidCount }}</div>
        <div class="stat-sub">{{ quickStats().paidAmount | number:'1.0-2' }} KÄ</div>
      </div>
    </div>
    <div class="stat-card warning">
      <div class="stat-icon">â³</div>
      <div class="stat-content">
        <div class="stat-label">ÄŒekÃ¡ na Ãšhradu</div>
        <div class="stat-value">{{ quickStats().pendingCount }}</div>
      </div>
    </div>
    <div class="stat-card danger">
      <div class="stat-icon">âš ï¸</div>
      <div class="stat-content">
        <div class="stat-label">Po Splatnosti</div>
        <div class="stat-value">{{ quickStats().overdueCount }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“ˆ</div>
      <div class="stat-content">
        <div class="stat-label">PrÅ¯mÄ›rnÃ¡ ÄŒÃ¡stka</div>
        <div class="stat-value">{{ quickStats().avgAmount | number:'1.0-2' }} KÄ</div>
      </div>
    </div>
  </div>

  <div class="overview" [ngClass]="responsiveService.isMobile ? 'mobile' : ''">
    @if(keycloakService.hasAdminAccess){
      <!-- Admin view -->
      <div class="chart-card">
        <invoice-chart-pie
          [data]="chartDataStatuses()"
          [title]="'PoÄet Faktur Dle Statusu'"
        ></invoice-chart-pie>
      </div>
      <div class="chart-card">
        <invoice-chart-doughnut
          [data]="chartDataAmountByStatus()"
          [title]="'CelkovÃ¡ ÄŒÃ¡stka Dle Statusu'"
        ></invoice-chart-doughnut>
      </div>
      <div class="chart-card">
        <invoice-chart-pie
          [data]="chartDataCustomers()"
          [title]="'PoÄet Faktur Dle ZÃ¡kaznÃ­ka'"
        ></invoice-chart-pie>
      </div>
      <div class="chart-card">
        <invoice-chart-pie
          [data]="chartDataCurrency()"
          [title]="'Distribuce MÄ›n'"
        ></invoice-chart-pie>
      </div>
      <div class="chart-card">
        <invoice-chart-stacked-bar
          [data]="filteredInvoices()"
          [statusColors]="statusColors()"
        ></invoice-chart-stacked-bar>
      </div>
      <div class="chart-card">
        <invoice-chart-horizontal-bar
          [data]="chartDataTopCustomers()"
          [title]="'Top 10 ZÃ¡kaznÃ­kÅ¯ Dle ÄŒÃ¡stky'"
        ></invoice-chart-horizontal-bar>
      </div>
    } @else {
      <!-- User view -->
      <div class="chart-card">
        <invoice-chart-pie
          [data]="chartDataStatuses()"
          [title]="'PoÄet Faktur Dle Statusu'"
        ></invoice-chart-pie>
      </div>
      <div class="chart-card">
        <invoice-chart-doughnut
          [data]="chartDataAmountByStatus()"
          [title]="'CelkovÃ¡ ÄŒÃ¡stka Dle Statusu'"
        ></invoice-chart-doughnut>
      </div>
      <div class="chart-card">
        <invoice-chart-line
          [data]="filteredInvoices()"
        ></invoice-chart-line>
      </div>
      <div class="chart-card">
        <invoice-chart-bar
          [data]="filteredInvoices()"
        ></invoice-chart-bar>
      </div>
      <div class="chart-card">
        <invoice-chart-stacked-bar
          [data]="filteredInvoices()"
          [statusColors]="statusColors()"
        ></invoice-chart-stacked-bar>
      </div>
      <div class="chart-card">
        <invoice-chart-pie
          [data]="chartDataCurrency()"
          [title]="'Distribuce MÄ›n'"
        ></invoice-chart-pie>
      </div>
    }

  </div>
</section>
