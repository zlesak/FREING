<section class="page-table-cards">
  <div class="toolbar">
    <h2 style="margin: 10px;">Faktury</h2>
    @if(keycloakService.hasAdminAccess){
      <button mat-button class="add-button" (click)="router.navigate(['/invoices/new'])">
        <mat-icon color="white" aria-label="add">add</mat-icon>
        Nová faktura
      </button>
    }
  </div>
  @if (loading()) {
    <mat-progress-bar style="width: 80%; margin: auto" mode="indeterminate"></mat-progress-bar>
  }

  @if (error) {
    <div class="error">{{ error }}</div>
  }
 @if(!loading() && !loadingCustomers() && !loadingSuppliers() && !error && dataSource.data){
  <div class="desktop-table">
    <table mat-table [dataSource]="dataSource" class="table-cards-table responsive-table" matSort>
      <ng-container matColumnDef="referenceNumber">
        <th mat-header-cell *matHeaderCellDef>Ref. číslo</th>
        <td mat-cell *matCellDef="let inv">{{ inv.referenceNumber || '-' }}</td>
      </ng-container>
      <ng-container matColumnDef="supplierId">
        <th mat-header-cell *matHeaderCellDef>Dodavatel</th>
        <td mat-cell *matCellDef="let inv">{{ getSupplierDisplayName(inv.supplierId) }}</td>
      </ng-container>
      <ng-container matColumnDef="receiveDate">
        <th mat-header-cell *matHeaderCellDef>Datum doručení</th>
        <td mat-cell *matCellDef="let inv">{{ inv.receiveDate ? (inv.receiveDate | date) : '-' }}</td>
      </ng-container>
      <ng-container matColumnDef="invoiceNumber">
        <th mat-header-cell *matHeaderCellDef>Číslo</th>
        <td mat-cell *matCellDef="let inv">{{ inv.invoiceNumber }}</td>
      </ng-container>
      <ng-container matColumnDef="customerName">
        <th mat-header-cell *matHeaderCellDef>Zákazník</th>
        <td mat-cell *matCellDef="let inv">{{ getCustomerDisplayName(inv.customerId) }}</td>
      </ng-container>
      <ng-container matColumnDef="issueDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Datum</th>
        <td mat-cell *matCellDef="let inv">{{ inv.issueDate | date }}</td>
      </ng-container>
      <ng-container matColumnDef="dueDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Splatnost</th>
        <td mat-cell *matCellDef="let inv">{{ inv.dueDate | date }}</td>
      </ng-container>
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Částka</th>
        <td mat-cell *matCellDef="let inv">{{ inv.amount }} {{ inv.currency }}</td>
      </ng-container>
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Stav</th>
        <td mat-cell *matCellDef="let inv">
          <span class="status-badge" [style.background-color]="getStatusColor(inv.status).background" [style.color]="getStatusColor(inv.status).color">
            {{ statusTranslation.getStatusLabel(inv.status) }}
          </span>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="responsive-header"></tr>
      <tr class="clickable-row responsive-row"
        mat-row *matRowDef="let row; columns: displayedColumns;"
        (click)="onInvoiceClick(row)"></tr>
    </table>
    <mat-paginator #paginator class="paginator"
             [length]="totalElements"
             [pageSize]="currentSize"
             [pageIndex]="currentPage"
             [pageSizeOptions]="[10, 25, 50, 100]"
             [showFirstLastButtons]="true"
             [disabled]="loading()"
             (page)="pageUpdate($event)"
             aria-label="Select page">
    </mat-paginator>
  </div>
  <div class="mobile-cards">
    <ng-container *ngFor="let inv of dataSource.data">
      <div class="table-card" (click)="onInvoiceClick(inv)">
        <div class="card-row"><strong>Číslo:</strong> {{ inv.invoiceNumber }}</div>
        <div class="card-row"><strong>Zákazník:</strong> {{ getCustomerDisplayName(inv.customerId) }}</div>
        <div class="card-row"><strong>Dodavatel:</strong> {{ getSupplierDisplayName(inv.supplierId) }}</div>
        <div class="card-row"><strong>Ref. číslo:</strong> {{ inv.referenceNumber || '-' }}</div>
        <div class="card-row"><strong>Datum vystavení:</strong> {{ inv.issueDate | date }}</div>
        <div class="card-row"><strong>Datum doručení:</strong> {{ inv.receiveDate ? (inv.receiveDate | date) : '-' }}</div>
        <div class="card-row"><strong>Splatnost:</strong> {{ inv.dueDate | date }}</div>
        <div class="card-row"><strong>Částka:</strong> {{ inv.amount }} {{ inv.currency }}</div>
        <div class="card-row"><strong>Stav:</strong> <span class="status-badge" [style.background-color]="getStatusColor(inv.status).background" [style.color]="getStatusColor(inv.status).color">{{ statusTranslation.getStatusLabel(inv.status) }}</span></div>
      </div>
    </ng-container>
    <mat-paginator #paginatorMobile class="paginator"
             [length]="totalElements"
             [pageSize]="currentSize"
             [pageIndex]="currentPage"
             [pageSizeOptions]="[10, 25, 50, 100]"
             [showFirstLastButtons]="true"
             [disabled]="loading()"
             (page)="pageUpdate($event)"
             aria-label="Select page">
    </mat-paginator>
  </div>
  }
</section>
