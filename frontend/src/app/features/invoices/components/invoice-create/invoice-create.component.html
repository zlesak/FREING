<section class="invoice-create">
  <mat-card class="card" appearance="raised">
    <mat-card-header>
      <h2>Nová faktura</h2>
    </mat-card-header>

    <mat-card-content>
      @if (error) {
        <div class="alert error">{{ error }}</div>
      }

      @if (success) {
        <div class="alert success">{{ success }}</div>
      }

      <div class="grid two-cols">
        <mat-form-field>
          <mat-label style="padding: 10px">Číslo faktury</mat-label>
          <input
            matInput
            type="text"
            [value]="invoiceNumber()"
            (input)="invoiceNumber.set($any($event.target).value)"
            placeholder="20250001"
            required
          />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Zákazník</mat-label>
          <input
            matInput
            [value]="customerName()"
            (input)="customerName.set($any($event.target).value)"
            required
          />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Email</mat-label>
          <input
            matInput
            type="email"
            [value]="customerEmail()"
            (input)="customerEmail.set($any($event.target).value)"
            required
          />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Datum vystavení</mat-label>
          <input
            matInput
            [matDatepicker]="IssueDatePicker"
            [value]="issueDate()"
            (dateChange)="issueDate.set($event.value)"
            required
          />
          <mat-datepicker-toggle matIconSuffix [for]="IssueDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #IssueDatePicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Splatnost</mat-label>
          <input
            matInput
            [matDatepicker]="dueDatePicker"
            [value]="dueDate()"
            (dateChange)="dueDate.set($event.value)"
            required
          />
          <mat-datepicker-toggle matIconSuffix [for]="dueDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #dueDatePicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Měna</mat-label>
          <mat-select
            [value]="currency()"
            (selectionChange)="currency.set($event.value)"
          >
            @for (c of currencyOptions; track c) {
              <mat-option [value]="c">{{ c }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Stav</mat-label>
          <mat-select
            [value]="status()"
            (selectionChange)="status.set($event.value)"
          >
            @for (s of statusOptions; track s) {
              <mat-option [value]="s">{{ s }}</mat-option>
            }
          </mat-select>
        </mat-form-field>


        <mat-form-field>
          <mat-label>Celková částka</mat-label>
          <input matInput type="number" [value]="totalAmount()" readonly />
        </mat-form-field>
      </div>
        <h3>Položky</h3>

        <table class="items">
          <thead>
          <tr>
            <th>Popis</th>
            <th>Množství</th>
            <th>Jedn. cena</th>
            <th>Celkem</th>
            <th></th>
          </tr>
          </thead>

          <tbody>
            @for (item of items; track item; let i = $index) {
              <tr>
                <td>
                  <mat-form-field>
                    <input
                      matInput
                      [(ngModel)]="item.description"
                      name="desc{{i}}"
                      (input)="recalcItemTotal(i)"
                    />
                  </mat-form-field>
                </td>
                <td>
                  <mat-form-field>
                    <input
                      matInput
                      type="number"
                      min="1"
                      [(ngModel)]="item.quantity"
                      name="qty{{i}}"
                      (input)="recalcItemTotal(i)"
                    />
                  </mat-form-field>
                </td>
                <td>
                  <mat-form-field>
                    <input
                      matInput
                      type="number"
                      step="0.01"
                      min="0"
                      [(ngModel)]="item.unitPrice"
                      name="price{{i}}"
                      (input)="recalcItemTotal(i)"
                    />
                  </mat-form-field>
                </td>
                <td>
                  <mat-form-field>
                    <input matInput [value]="item.totalPrice" readonly />
                  </mat-form-field>
                </td>
                <td style="width: 30px">
                  <button
                    mat-icon-button
                    color="warn"
                    type="button"
                    (click)="removeItem(i)"
                    [disabled]="items.length === 1"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>

      <button
        mat-button
        color="primary"
        type="button"
        class="add-item"
        (click)="addItem()"
      >
        <mat-icon aria-label="add">add</mat-icon>
        Přidat položku
      </button>

      <div class="actions">
        <button
          mat-flat-button
          color="accent"
          (click)="submit()"
          [disabled]="!readyToSubmit()">
          Vytvořit
        </button>
        <a mat-button routerLink="/invoices">Zpět</a>
      </div>
    </mat-card-content>
  </mat-card>
</section>
